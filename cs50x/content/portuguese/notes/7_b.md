SQL
---

*   Vamos olhar para um novo programa na nossa janela do terminal, `sqlite3`, um programa de linha de comando que nos permite usar outra linguagem, SQL (pronuncia-se como "sequel").
*   Vamos executar alguns comandos para criar um novo banco de dados chamado `favorites.db` e importar nosso arquivo CSV para uma tabela chamada "favorites":
    
        ~/ $ sqlite3 favorites.db
        Versão SQLite 3.22.0 2018-01-22 18:45:57
        Digite ".help" para obter dicas de uso.
        sqlite> .mode csv
        sqlite> .import "CS50 2019 - Lecture 7 - Favorite TV Shows (Responses) - Form Responses 1.csv" favorites
        
    
*   Vemos um `favorites.db` em nosso IDE depois de executar isso, e agora podemos usar o SQL para interagir com nossos dados:
    
        sqlite> SELECT title FROM favorites;
        title
        Dynasty
        The Office
        Blindspot
        24
        Friends
        psych
        Veep
        Survivor
        ...
        
    
*   Podemos até classificar nossos resultados:
    
        sqlite> SELECT title FROM favorites ORDER BY title;
        title
        /
        24
        9009
        Adventure Time
        Airplane Repo
        Always Sunny
        Ancient Aliens
        ...
        
    
*   E obter a contagem de quantas vezes cada título aparece:
    
        sqlite> SELECT title, COUNT(title) FROM favorites GROUP BY title;
        title | COUNT(title)
        / | 1
        24 | 1
        9009 | 1
        Adventure Time | 1
        Airplane Repo | 1
        Always Sunny | 1
        Ancient Aliens | 1
        ...
        
    
*   Podemos até definir a contagem de cada título para uma nova variável, `n`, e ordenar nossos resultados por essa contagem, em ordem decrescente. Em seguida, podemos ver os 10 principais resultados com `LIMIT 10`:
    
        sqlite> SELECT title, COUNT(title) AS n FROM favorites GROUP BY title ORDER BY n DESC LIMIT 10;
        title | n
        The Office | 30
        Friends | 20
        Game of Thrones | 20
        Breaking Bad | 14
        Black Mirror | 9
        Rick and Morty | 9
        Brooklyn Nine-Nine | 5
        Game of thrones | 5
        No | 5
        Prison Break | 5
        
    
*   O SQL é uma linguagem que nos permite trabalhar com um banco de dados relacional, uma aplicação que nos permite armazenar dados e trabalhar com eles de forma mais rápida do que com um CSV.
*   Com o comando `.schema`, podemos ver como o formato para a tabela dos nossos dados é criado:
    
        sqlite> .schema
        CREATE TABLE favorites(
          "Timestamp" TEXT,
          "title" TEXT,
          "genres" TEXT
        );
        
    
*   Acontece que, ao trabalhar com dados, só precisamos de quatro operações:
    *   `CREATE` (criar)
    *   `READ` (ler)
    *   `UPDATE` (atualizar)
    *   `DELETE` (excluir)
*   No SQL, os comandos para realizar cada uma dessas operações são:
    *   `INSERT` (inserir)
    *   `SELECT` (selecionar)
    *   `UPDATE` (atualizar)
    *   `DELETE` (excluir)
*   Primeiro, precisaremos inserir uma tabela com o comando `CREATE TABLE table (column type, ...);`.
*   O SQL também possui seus próprios tipos de dados para otimizar a quantidade de espaço usado para armazenar dados:
    *   `BLOB`, para "binary large object", dados binários brutos que podem representar arquivos
    *   `INTEGER`
        *   `smallint`
        *   `integer`
        *   `bigint`
    *   `NUMERIC`
        *   `boolean`
        *   `date`
        *   `datetime`
        *   `numeric(scale,precision)`, que resolve a imprecisão de ponto flutuante usando quantos bits forem necessários, para cada dígito antes e depois do ponto decimal
        *   `time`
        *   `timestamp`
    *   `REAL`
        *   `real`, para valores de ponto flutuante
        *   `double precision`, com mais bits
    *   `TEXT`
        *   `char(n)`, para um número exato de caracteres
        *   `varchar(n)`, para um número variável de caracteres, até um limite específico
        *   `text`
*   O SQLite é um aplicativo de banco de dados que suporta SQL, e existem muitas empresas com aplicativos de servidor que suportam SQL, incluindo Oracle Database, MySQL, PostgreSQL, MariaDB e Microsoft Access.
*   Depois de inserir valores, podemos usar funções para realizar cálculos também:
    *   `AVG` (média)
    *   `COUNT` (contagem)
    *   `DISTINCT`, para obter valores distintos sem duplicatas
    *   `MAX` (máximo)
    *   `MIN` (mínimo)
    *   ...
*   Também existem outras operações que podemos combinar conforme necessário:
    *   `WHERE`, para corresponder a uma condição rigorosa
    *   `LIKE`, para corresponder a substrings em texto
    *   `LIMIT` (limite)
    *   `GROUP BY`, para agrupar por
    *   `ORDER BY`, para ordenar por
    *   `JOIN`, para combinar dados de várias tabelas
*   Podemos atualizar os dados com `UPDATE table SET column=value WHERE condition;`, que pode incluir 0, 1 ou mais linhas dependendo da nossa condição. Por exemplo, podemos dizer `UPDATE favorites SET title = "The Office" WHERE title LIKE "%office"`, e isso definirá todas as linhas com o título contendo "office" como "The Office" para torná-las consistentes.
*   E podemos remover as linhas correspondentes com `DELETE FROM table WHERE condition;`, como em `DELETE FROM favorites WHERE title = "Friends";`.
*   Podemos até excluir a tabela inteira com outro comando, `DROP`.