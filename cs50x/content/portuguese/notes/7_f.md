Problemas
--------

*   Um problema com bancos de dados são as **condições de corrida**, onde o tempo de duas ações ou eventos causa um comportamento inesperado.
*   Por exemplo, considere dois colegas de quarto e uma geladeira compartilhada em sua república. O primeiro colega de quarto chega em casa e vê que não há leite na geladeira. Então o primeiro colega de quarto sai para a loja comprar leite, e enquanto ele está na loja, o segundo colega de quarto chega em casa, vê que não há leite e sai para outra loja comprar leite. Mais tarde, haverá duas garrafas de leite na geladeira. Deixando um bilhete, podemos resolver esse problema. Podemos até trancar a geladeira para que nosso colega de quarto não consiga verificar se há leite até que tenhamos voltado.
*   Isso pode acontecer em nosso banco de dados se tivermos algo assim:

        linhas = db.execute("SELECT likes FROM posts WHERE id=?", id);
        likes = linhas[0]["likes"]
        db.execute("UPDATE posts SET likes = ?", likes + 1);

    *   Primeiro, estamos obtendo o número de curtidas em um post com um determinado ID. Em seguida, definimos o número de curtidas como esse número mais um.
    *   Mas agora, se tivermos dois servidores web diferentes tentando adicionar uma curtida, eles podem definir o valor como o mesmo em vez de realmente adicionar uma a cada vez. Por exemplo, se houver 2 curtidas, ambos os servidores verificarão o número de curtidas, verão que há 2 e definirão o valor como 3. Uma das curtidas será perdida.
*   Para resolver isso, podemos usar transações, onde um conjunto de ações é garantido para acontecer juntas.
*   Outro problema no SQL é chamado de **ataque de injeção de SQL**, onde um adversário pode executar seus próprios comandos em nosso banco de dados.
*   Por exemplo, alguém pode tentar digitar `malan@harvard.edu'--` como seu e-mail. Se tivermos uma consulta SQL que seja uma string formatada (sem escapar ou substituir caracteres perigosos da entrada), como `f"SELECT * FROM users WHERE username = '{username}' AND password = '{password}'"`, então a consulta acabará sendo `f"SELECT * FROM users WHERE username = 'malan@harvard.edu'--' AND password = '{password}'"`, que na verdade selecionará a linha onde `username = 'malan@harvard.edu'` e transformará o restante da linha em um comentário. Para evitar isso, devemos usar espaços reservados `?` para que nossa biblioteca SQL escape automaticamente as entradas do usuário.'