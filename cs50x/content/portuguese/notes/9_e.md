Flask e SQL
-----------

* Assim como vimos como o Python pode se comunicar com um banco de dados SQL, podemos combinar o poder do Flask, Python e SQL para criar um aplicativo da web onde os dados persistirão!
* Para implementar isso, você precisará seguir algumas etapas.
* Primeiro, modifique o arquivo `requirements.txt` da seguinte forma:

        cs50
        Flask
        
* Modifique o arquivo `index.html` da seguinte forma:

        {% extends "layout.html" %}
        
        {% block body %}
            <h1>Registrar</h1>
            <form action="/register" method="post">
                <input autocomplete="off" autofocus name="name" placeholder="Nome" type="text">
                {% for sport in sports %}
                    <input name="sport" type="radio" value="{{ sport }}"> {{ sport }}
                {% endfor %}
                <button type="submit">Registrar</button>
            </form>
        {% endblock %}
        
* Modifique o arquivo `layout.html` da seguinte forma:

        <!DOCTYPE html>
        
        <html lang="pt-BR">
            <head>
                <meta name="viewport" content="initial-scale=1, width=device-width">
                <title>froshims</title>
            </head>
            <body>
                {% block body %}{% endblock %}
            </body>
        </html>
        
* Garanta que o arquivo `failure.html` apareça da seguinte forma:

        {% extends "layout.html" %}
        
        {% block body %}
            Você não está registrado!
        {% endblock %}
        
* Modifique o arquivo `registrants.html` para aparecer da seguinte forma:

        {% extends "layout.html" %}
        
        {% block body %}
            <h1>Registrados</h1>
            <table>
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Esporte</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for registrant in registrants %}
                        <tr>
                            <td>{{ registrant.name }}</td>
                            <td>{{ registrant.sport }}</td>
                            <td>
                                <form action="/deregister" method="post">
                                    <input name="id" type="hidden" value="{{ registrant.id }}">
                                    <button type="submit">Cancelar registro</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endblock %}
        
    Perceba que um valor oculto `registrant.id` está incluso para que seja possível utilizá-lo depois em `app.py`
    
* Por fim, modifique o arquivo `app.py` da seguinte forma:

        # Implementa um formulário de registro, armazenando os registrantes em um banco de dados SQLite, com suporte para cancelamento de registro
        
        from cs50 import SQL
        from flask import Flask, redirect, render_template, request
        
        app = Flask(__name__)
        
        db = SQL("sqlite:///froshims.db")
        
        SPORTS = [
            "Basquete",
            "Futebol",
            "Ultimate Frisbee"
        ]
        
        @app.route("/")
        def index():
            return render_template("index.html", sports=SPORTS)
        
        @app.route("/deregister", methods=["POST"])
        def deregister():
        
            # Esquece o registrante
            id = request.form.get("id")
            if id:
                db.execute("DELETE FROM registrants WHERE id = ?", id)
            return redirect("/registrants")
        
        @app.route("/register", methods=["POST"])
        def register():
        
            # Validação do envio
            name = request.form.get("name")
            sport = request.form.get("sport")
            if not name or sport not in SPORTS:
                return render_template("failure.html")
        
            # Lembra do registrante
            db.execute("INSERT INTO registrants (name, sport) VALUES(?, ?)", name, sport)
        
            # Confirmação do registro
            return redirect("/registrants")
        
        @app.route("/registrants")
        def registrants():
            registrants = db.execute("SELECT * FROM registrants")
            return render_template("registrants.html", registrants=registrants)
        
    Note que a biblioteca `cs50` é utilizada. Uma rota é incluída para o método `post` em `register`. Essa rota irá pegar o nome e o esporte informados no formulário de registro e executar uma consulta SQL para adicionar o `nome` e o `esporte` na tabela `registrants`. O `deregister` faz uma rota para uma consulta SQL que irá pegar o `id` do usuário e utilizar essa informação para cancelar o registro deste indivíduo.
    
* Você pode ler mais na [documentação do Flask](https://flask.palletsprojects.com).