Sessão
-------

*   Embora o código acima seja útil do ponto de vista administrativo, onde um administrador do back-office pode adicionar e remover indivíduos do banco de dados, pode-se imaginar como esse código não é seguro para implementar em um servidor público.
*   Primeiro, atores mal-intencionados podem tomar decisões em nome de outros usuários ao acionar o botão de desregistro, apagando efetivamente suas respostas registradas no servidor.
*   Serviços da web como o Google usam credenciais de login para garantir que os usuários tenham acesso apenas aos dados corretos.
*   Na verdade, podemos implementar isso usando _cookies_. Cookies são arquivos pequenos armazenados em seu computador para que ele possa se comunicar com o servidor e dizer efetivamente: "Sou um usuário autorizado que já fez o login".
*   Na forma mais simples, podemos implementar isso criando uma pasta chamada `login` e, em seguida, adicionando os seguintes arquivos.
*   Primeiro, crie um arquivo chamado `requirements.txt` que contenha o seguinte conteúdo:
    
        Flask
        Flask-Session
        
    
    Observe que, além do `Flask`, também incluímos o `Flask-Session`, que é necessário para dar suporte a sessões de login.
    
*   Em segundo lugar, em uma pasta `templates`, crie um arquivo chamado `layout.html` com o seguinte conteúdo:
    
        <!DOCTYPE html>
        
        <html lang="en">
            <head>
                <meta name="viewport" content="initial-scale=1, width=device-width">
                <title>store</title>
            </head>
            <body>
                {% block body %}{% endblock %}
            </body>
        </html>
        
    
    Observe que isso fornece um layout muito simples com um título e um corpo.
    
*   Em terceiro lugar, crie um arquivo na pasta `templates` chamado `index.html` com o seguinte conteúdo:
    
        {% extends "layout.html" %}
        
        {% block body %}
        
            {% if session["name"] %}
                Você está conectado como {{ session["name"] }}. <a href="/logout">Sair</a>.
            {% else %}
                Você não está conectado. <a href="/login">Entrar</a>.
            {% endif %}
        
        {% endblock %}
        
    
    Observe que este arquivo verifica se `session["name"]` existe. Se existir, ele exibirá uma mensagem de boas-vindas. Se não, ele recomendará que você navegue para uma página para fazer login.
    
*   Em quarto lugar, crie um arquivo chamado `login.html` e adicione o seguinte código:
    
        {% extends "layout.html" %}
        
        {% block body %}
        
            <form action="/login" method="post">
                <input autocomplete="off" autofocus name="name" placeholder="Nome" type="text">
                <button type="submit">Entrar</button>
            </form>
        
        {% endblock %}
        
    
    Observe que este é o layout de uma página de login básica.
    
*   Finalmente, crie um arquivo na pasta `login` chamado `app.py` e escreva o código a seguir:
    
        from flask import Flask, redirect, render_template, request, session
        from flask_session import Session
        
        # Configurar a aplicação
        app = Flask(__name__)
        
        # Configurar a sessão
        app.config["SESSION_PERMANENT"] = False
        app.config["SESSION_TYPE"] = "filesystem"
        Session(app)
        
        
        @app.route("/")
        def index():
            if not session.get("name"):
                return redirect("/login")
            return render_template("index.html")
        
        
        @app.route("/login", methods=["GET", "POST"])
        def login():
            if request.method == "POST":
                session["name"] = request.form.get("name")
                return redirect("/")
            return render_template("login.html")
        
        
        @app.route("/logout")
        def logout():
            session["name"] = None
            return redirect("/")
        
    
    Observe as _importações_ modificadas na parte superior do arquivo, incluindo `session`, que permitirá o suporte a sessões. Mais importante, observe como `session["name"]` é usado nas rotas `login` e `logout`. A rota `login` atribuirá o nome de login fornecido a `session["name"]`. No entanto, na rota `logout`, o logout é implementado simplesmente definindo `session["name"]` como `None`.
    
*   Você pode ler mais sobre sessões na [documentação do Flask](https://flask.palletsprojects.com/en/2.2.x/api/?highlight=session#flask.session).