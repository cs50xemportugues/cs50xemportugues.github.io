<!DOCTYPE html>
<!-- saved from url=(0037)https://cs50.harvard.edu/summer/2020/ -->
<html lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property="og:description" content="Introdu√ß√£o √†s faculdades intelectuais da ci√™ncia da computa√ß√£o e a arte da programa√ß√£o. Este curso ensina aos estudantes a como pensar algoritmicamente e a como resulver problemas eficientemente. Os t√≥picos incluem abstra√ß√£o, algoritmos, estruturas de dados, encapsula√ß√£o, gerenciamento de recursos, seguran√ßa, e engenharia de software. O curso inclui as linguagens C, Python, e SQL, assim como HTML, CSS, e JavaScript. As listas de problemas s√£o inspiradas pelas √°reas das artes, humanas, ci√™ncias sociais, e ci√™ncias naturais. O curso cultina em um projeto final.">

<meta property="og:image" content=""><meta property="og:title" content="CS50"><link href="https://cs50.harvard.edu/summer/2020/favicon.ico?1593528821" rel="icon">

<!-- https://fontawesome.com/how-to-use/on-the-web/referencing-icons/basic-use -->
<script src="https://kit.fontawesome.com/df44463090.js" crossorigin="anonymous"></script>
<link href="../../arquivos/all.min.css" rel="stylesheet">

<link href="../../arquivos/page.css" rel="stylesheet">

<link rel="stylesheet" type="text/css" href="../../arquivos/personalizado.css">

<!-- http://getbootstrap.com/docs/4.5/getting-started/introduction/ -->
<script src="../../arquivos/jquery.min.js"></script>
<script src="../../arquivos/popper.min.js"></script>
<script src="../../arquivos/bootstrap.min.js"></script>

<!-- https://momentjs.com/, https://momentjs.com/timezone/ -->
<script src="../../arquivos/moment.min.js"></script>
<script src="../../arquivos/moment-timezone-with-data.min.js"></script>
<script src="../../arquivos/luxon.min.js"></script>

<!-- https://www.algolia.com/doc/guides/building-search-ui/installation/js/ -->
<script src="../../arquivos/algoliasearchLite.min.js"></script>
<script src="../../arquivos/instantsearch.production.min.js"></script>

<script src="../../arquivos/jekyll-theme-cs50.js"></script>

<title>Recuperar - CS50x em Portugu√™s</title>
</head>

    <body>



        <div class="container-fluid">

            <div class="row">

                <aside class="col-md">

                    <header><h1 data-id="this-is-cs50"><a href="https://cs50xemportugues.github.io/">Este √© o CS50x</a></h1>

<p><a href="https://cs50.harvard.edu/">O curso da Universidade de Harvard em Portugu√™s!</a><br>
2021</p></header>

                    <button aria-controls="nav" aria-expanded="false" class="btn btn-sm collapsed d-md-none" data-target="aside &gt; nav" data-toggle="collapse">
                        Menu
                    </button>

                    <nav class="collapse d-md-block" id="nav"><hr>

<ul class="fa-ul">
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../semanas/0">Semana 0</a> Scratch <strong class="text-white">üò∫</strong></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../semanas/1">Semana 1</a> Linguagem C</li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../semanas/2">Semana 2</a> Vetores</li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../semanas/3">Semana 3</a> Algoritmos</li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../semanas/4">Semana 4</a> Mem√≥ria <strong class="text-white">üß†</strong></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../semanas/5">Semana 5</a> Estruturas de Dados</li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../semanas/6">Semana 6</a> Python <strong class="text-white">üêç</strong></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../semanas/7">Semana 7</a> SQL</li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../semanas/8">Semana 8</a> Informa√ß√£o</li>
</ul>

<ul>
  <li data-marker="*"><a href="../../especializacoes">Especializa√ß√µes</a></li>
  <li data-marker="*"><a href="../../projetofinal">Projeto Final</a></li>
</ul>

<hr>

<ul class="fa-ul">
  <li data-marker="*" class="small"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../guia.pdf">Guia R√°pido de Inicializa√ß√£o</a></li>
</ul>

<hr>

<ul class="fa-ul">
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../perguntasfrequentes">Perguntas Frequentes</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../tutorias">Tutorias</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../problemas">Listas de Problemas</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../secoes">Se√ß√µes</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../equipe">Equipe</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../curriculo">Curr√≠culo do Curso</a></li>
</ul>

<hr>

<ul class="small fa-ul">
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="https://ide.cs50.io/">CS50 IDE</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="https://sqlitebrowser.org/">Navegador de Banco de Dados para o SQLite</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="https://man.cs50.io/">Manual CS50</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="https://docs.python.org/3.7/search.html">Documenta√ß√£o Python</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="https://stackoverflow.com/search">Stack Overflow</a></li>
  <li data-marker="*"><span class="fa-li"><i class="fas fa-circle"></i></span><a href="../../guiadeestilo">Guia de Estilo</a></li>
</ul>

<hr>

<p style="font-size: initial"><a href="../../obrigado">Agradecemos</a> √† todos os ex-alunos e amigos do CS50</p></nav>

                    <footer></footer>

                </aside>

                <main class="col-md markdown-body" style="margin-bottom: 286px;">




<h1 id="recover">Recuperar</h1>

<p>Implemente um programa que recupera imagens, em formato JPEG, a partir de um arquivo forense, como exemplificado abaixo.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./recuperar cartao.raw
</code></pre></div></div>

<h2 id="background">Entendendo o problema</h2>

<p>Antes de publicar este problema, n√≥s passamos os √∫ltimos dias tirando fotos das pessoas que n√≥s conhecemos, que foram salvas em uma c√¢mera digital, em formato JPEG, no cart√£o de mem√≥ria. Infelizmente, n√≥s deletamos todas as imagens! Felizmente, no mundo da computa√ß√£o, "deletado" n√£o significa necessariamente "deletado", mas sim "esquecido". Ainda que a c√¢mera insista que o cart√£o de mem√≥ria esteja vazio, n√≥s temos certeza que isso n√£o √© verdade. E portanto, n√≥s desejamos (e esperamos) que voc√™ escreva um programa que recupere as fotos para n√≥s!</p>

<p>Ainda que imagens em formato JPEG sejam mais complicadas do que imagens em formato BMP, imagens em formato JPEG possuem "assinaturas", sequ√™ncias de bytes que as diferenciam de outros formatos de arquivo. Para sermos mais espec√≠ficos, os primeiros tr√™s bytes de uma imagem JPEG s√£o</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0xff 0xd8 0xff
</code></pre></div></div>

<p>do primeiro ao terceiro byte, da esquerda para a direita. O quarto byte, por outro lado, √© <code class="highlighter-rouge">0xe0</code>, <code class="highlighter-rouge">0xe1</code>, <code class="highlighter-rouge">0xe2</code>, <code class="highlighter-rouge">0xe3</code>, <code class="highlighter-rouge">0xe4</code>, <code class="highlighter-rouge">0xe5</code>, <code class="highlighter-rouge">0xe6</code>, <code class="highlighter-rouge">0xe7</code>, <code class="highlighter-rouge">0xe8</code>, <code class="highlighter-rouge">0xe9</code>, <code class="highlighter-rouge">0xea</code>, <code class="highlighter-rouge">0xeb</code>, <code class="highlighter-rouge">0xec</code>, <code class="highlighter-rouge">0xed</code>, <code class="highlighter-rouge">0xee</code>, ou <code class="highlighter-rouge">0xef</code>. Em outras palavras, os primeiros quatro bits do quarto byte s√£o  <code class="highlighter-rouge">1110</code>.</p>

<p>Se voc√™ encontrar esta sequ√™ncia de quatro bytes em um dispositivo usado para armazenar imagens (um cart√£o de mem√≥ria, por exemplo), √© prov√°vel que eles indiquem o in√≠cio de uma imagem em formato JPEG. Na realidade, pode ser que voc√™ encontre essa sequ√™ncia de bytes em algum dispositivo de armazenamento por acaso, portanto, recupera√ß√£o de dados n√£o √© uma ci√™ncia exata.</p>

<p>Felizmente, c√¢meras digitais tendem a armazenar fotos em cart√µes de mem√≥ria de forma cont√≠nua, onde cada foto √© armazenada imediatamente ap√≥s a √∫ltima foto tirada. Consequentemente, o in√≠cio de uma imagem JPEG normalmente indica o fim de outra imagem. Entretanto, c√¢meras digitais normalmente inicializam cart√µes de mem√≥ria usando um sistema de armazenamento do tipo FAT, onde cada "bloco de armazenamento" √© igual a 512 bytes (B). Isso significa que essas c√¢meras s√≥ escrevem nesses cart√µes em unidades de 512 B. Uma foto cujo tamanho √© igual a 1 MB (ou seja, 1 048 576 B) ocupa 1048576 √∑ 512 = 2048 "blocos" em um cart√£o de mem√≥ria. Entretanto, uma foto cujo tamanho √© 1 byte a menos (1 048 575 B) ocupa a mesma quantidade de "blocos"! O espa√ßo desperdi√ßado na mem√≥ria √© chamado de slack space, que podemos traduzir como "espa√ßo vazio". Investigadores for√™nse costumam analizar o slack space para encontrar resqu√≠cios de dados suspeitos.</p>

<p>O que todos esses detalhes significam √© que voc√™, o investigador, pode escrever um programa que percorre uma c√≥pia de um cart√£o de mem√≥ria, procurando por assinaturas de formato JPEG. Cada vez que voc√™ encontrar uma assinatura, voc√™ pode abrir um novo arquivo em modo de escrita e preencher esse arquivo recentemente criado com os bytes do cart√£o de mem√≥ria, e fechando esse arquivo assim que voc√™ encontrar outra assinatura. Al√©m disso, ao inv√©s de ler os bytes do cart√£o de mem√≥ria um de cada vez, voc√™ pode copiar 512 desses bytes para um buffer (espa√ßo de armazenamento tempor√°rio) por quest√£o de efici√™ncia. Gra√ßas ao sistema de armazenamento FAT, voc√™ pode confiar que as assinaturas de uma imagem JPEG estar√£o "alinhadas ao bloco". Isso quer dizer que voc√™ s√≥ precisa procurar por essas assinaturas nos primeiros quatro bytes de um bloco.</p>

<p>Obviamente, imagens em formato JPEG podem ocupar v√°rios blocos de armazenamento cont√≠guos, caso contr√°rio, nenhuma imagem em formato JPEG seria maior do que 512 bytes. Mas pode ser que o √∫ltimo byte de uma imagem JPEG n√£o esteja armazenado exatamente no fim do bloco. Lembre-se da possibilidade de haver slack space, que traduzimos como ‚Äúespa√ßo vazio‚Äù ou ‚Äúespa√ßo desperdi√ßado‚Äù. Mas n√£o se preocupe. Por conta do fato que este cart√£o de mem√≥ria era novo quando eu comecei a tirar fotos, √© prov√°vel que ele foi "zerado" (preenchido com zeros e uns) pelo fabricante, o que significa que todos os "espa√ßos desperdi√ßados" foram preenchidos com zeros. N√£o tem problema se esses zeros "sobrando" forem inclu√≠dos nas imagens JPEG que voc√™ recuperar. Eles certamente ainda ser√£o vis√≠veis.</p>

<p>De qualquer maneira, eu s√≥ tenho um cart√£o de mem√≥ria, mas existem muitas pessoas fazendo o curso CS50! E portanto, eu criei uma ‚Äúimagem forense‚Äù do cart√£o de mem√≥ria, armazenando todo seu conte√∫do, byte por byte, em um arquivo chamado <code class="highlighter-rouge">cartao.raw</code>. Para que voc√™ n√£o perca tempo percorrendo milh√µes de 0s desnecessariamente, eu s√≥ copiei os primeiros megabytes do cart√£o de mem√≥ria. Mas voc√™ ver√° que a c√≥pia possui 50 imagens em formato JPEG.</p>

<h2 id="getting-started">Come√ßando</h2>

<p>Voc√™ deve baixar o ‚Äúc√≥digo de distribui√ß√£o‚Äù (c√≥digo inicial) para seu CS50 IDE. Entre no <a href="https://cs50.io/">CS50 IDE</a> usando sua conta GitHub, e em seguida, na janela do terminal, siga as instru√ß√µes abaixo.</p>

<ol>
	<li>Execute <code class="highlighter-rouge">cd</code> para garantir que voc√™ est√° localizado em <code class="highlighter-rouge">~/</code> (diret√≥rio inicial).</li>

	<li>Execute <code class="highlighter-rouge">mkdir problemas4</code> para criar um diret√≥rio chamado <code class="highlighter-rouge">problemas4</code> localizado no seu diret√≥rio inicial.</li>

	<li>Execute <code class="highlighter-rouge">cd problemas4</code> para entrar no diret√≥rio <code class="highlighter-rouge">problemas4</code>.</li>

	<li>Execute <code class="highlighter-rouge">wget https://cs50xemportugues.github.io/2020/problemas/4/recuperar/recuperar.zip</code> para baixar um arquivo ZIP (um arquivo compactado) com o c√≥digo de distribui√ß√£o deste problema.</li>

	<li>Execute <code class="highlighter-rouge">unzip recuperar.zip</code> para descompactar esse arquivo.</li>

	<li>Execute <code class="highlighter-rouge">rm recuperar.zip</code> seguido de <code class="highlighter-rouge">yes</code> ou <code class="highlighter-rouge">y</code> para deletar esse arquivo ZIP.</li>

	<li>Execute <code class="highlighter-rouge">ls</code>. Voc√™ ver√° um diret√≥rio chamado <code class="highlighter-rouge">recuperar</code>, que estava dentro daquele arquivo ZIP.</li>

	<li>Execute <code class="highlighter-rouge">cd recuperar</code> para entrar nesse diret√≥rio.</li>

	<li>Execute <code class="highlighter-rouge">ls</code>. Voc√™ ver√° os arquivos de distribui√ß√£o deste problema, incluindo <code class="highlighter-rouge">cartao.raw</code> e <code class="highlighter-rouge">recuperar.c</code>.</li>
</ol>

<h2 id="specification">Especifica√ß√£o</h2>

<p>Implemente um programa chamado <code class="highlighter-rouge">recuperar	</code> que recupera imagens em formato JPEG a partir de uma ‚Äúimagem forense‚Äù.</p>

<ul>
	<li data-marker="*">Implemente seu programa em um arquivo chamado <code class="highlighter-rouge">recuperar.c</code> localizado em um diret√≥rio chamado <code class="highlighter-rouge">recuperar</code>.</li>
	<li data-marker="*">Seu programa deve aceitar exatamente um argumento de linha de comando, que no caso ser√° o nome de uma imagem forense, a partir da qual voc√™ recuperar√° as imagens em formato JPEG.</li>
	<li data-marker="*">Se seu programa n√£o for executado exatamente com um argumento de linha de comando, ele deve alertar o usu√°rio do uso correto, e em seguida <code class="highlighter-rouge">main</code> deve retornar <code class="highlighter-rouge">1</code>.</li>
	<li data-marker="*">Se a imagem forense (<code class="highlighter-rouge">cartao.raw</code>) n√£o puder ser aberta em modo leitura, seu progama deve informar ao usu√°rio, e em seguida <code class="highlighter-rouge">main</code> deve retornar <code class="highlighter-rouge">1</code>.</li>
	<li data-marker="*">Se seu programa usar a fun√ß√£o <code class="highlighter-rouge">malloc</code>, ele n√£o pode vazar nenhuma quantidade de mem√≥ria.</li>
</ul>

<h2 id="walkthrough">Passo a Passo</h2>

<div class="border embed-responsive embed-responsive-16by9" data-video="">
    <iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" class="embed-responsive-item" src="https://www.youtube.com/embed/ooL0r_8N9ms?modestbranding=1&amp;rel=0&amp;showinfo=0"></iframe>
</div>

<h2 id="usage">Uso correto</h2>

<p>Seu programa deve se comportar como os exemplos abaixo.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./recuperar
Uso correto: ./recuperar imagem
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./recuperar cartao.raw
</code></pre></div></div>

<h2 id="hints">Dicas</h2>

<p>Lembre-se que voc√™ pode abrir o arquivo <code class="highlighter-rouge">cartao.raw</code> usando a fun√ß√£o <code class="highlighter-rouge">fopen</code>, como mostrado abaixo, desde que <code class="highlighter-rouge">argv[1]</code> exista.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">FILE</span> <span class="o">*</span><span class="n">arquivo</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">"r"</span><span class="p">);</span>
</code></pre></div></div>

<p>Quando executado, seu programa deve recuperar cada uma das imagens em formato JPEG do arquivo <code class="highlighter-rouge">cartao.raw</code>, armazenando cada imagem como sendo arquivos √∫nicos no seu diret√≥rio atual. Seu programa deve numerar os arquivos criados nomeando cada um <code class="highlighter-rouge">###.jpg</code>, onde <code class="highlighter-rouge">###</code> √© um n√∫mero decimal com 3 d√≠gitos de <code class="highlighter-rouge">000</code> adiante. (Para isso, use a fun√ß√£o <code class="highlighter-rouge">sprintf</code>.) Voc√™ n√£o precisa tentar recuperar os nomes originais das imagens. Para checar se as imagens em formato JPEG que seu programa criar est√£o corretas, simplesmente clique duas vezes para abri-las e dar uma olhada! Se cada foto parecer estar intacta, sua opera√ß√£o certamente foi um sucesso!</p>

<p>Entretanto, √© prov√°vel que as primeiras imagens em formato JPEG que seu programa criar n√£o estar√£o corretas. (Se voc√™ abri-las e n√£o ver nada, elas certamente n√£o est√£o corretas!) Execute o programa abaixo para deletar todas as imagens JPEG no seu diret√≥rio atual.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rm *.jpg
</code></pre></div></div>

<p>Se voc√™ n√£o quiser que o terminal te pe√ßa para confirmar cada remo√ß√£o, execute o comando abaixo.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rm -f *.jpg
</code></pre></div></div>

<p>Mas tome cuidado com a flag <code class="highlighter-rouge">-f</code>, por que ela ‚Äúfor√ßa‚Äù a remo√ß√£o do arquivo sem confirmar com voc√™.</p>

<p>Se voc√™ quiser criar um novo tipo de dado para armazenar um byte, voc√™ pode fazer isso com a linha mostrada abaixo, que define um novo tipo chamado <code class="highlighter-rouge">BYTE</code> que √© um <code class="highlighter-rouge">uint8_t</code> (um tipo definido em code class="highlighter-rouge">stdint.h</code> que representa um inteiro sem sinal de 8 bits).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>typedef uint8_t BYTE;
</code></pre></div></div>

<p>Lembre-se que voc√™ pode ler dados de um arquivo usando a fun√ß√£o <code class="highlighter-rouge">fread</code>, que ler√° dados de um arquivo e os armazenar√° em algum local de mem√≥ria e retornar√° o n√∫mero de itens lidos do arquivo com sucesso.</p>

<h2 id="testing">Como Testar Seu C√≥digo</h2>

<p>Execute a linha abaixo para avaliar a corre√ß√£o do seu c√≥digo usando a ferramenta <code class="highlighter-rouge">check50</code>. N√£o se esque√ßa de compilar e testar o c√≥digo voc√™ tamb√©m!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>check50 cs50xemportugues/problemas/2020/recuperar
</code></pre></div></div>

<p>Execute a linha abaixo para avaliar o estilo do seu c√≥digo usando a ferramenta <code class="highlighter-rouge">style50</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>style50 recuperar.c
</code></pre></div></div>

<h2>Como Adaptar Seu C√≥digo</h2>

<p>TODO</p>

<h2 id="how-to-submit">Como Enviar</h2>

<p>Execute a linha abaixo, em seguida informe sua conta GitHub e sua senha quando o terminal pedir. Por medidas de seguran√ßa, voc√™ ver√° asteriscos (<code class="highlighter-rouge">*</code>) ao inv√©s dos caracteres reais na sua senha.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>submit50 cs50/problems/2020/x/recover
</code></pre></div></div>











				</main>

			</div>

		</div>

        <!--
        <div aria-hidden="true" aria-labelledby="searchTitle" class="markdown-body modal" id="search" role="dialog" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="pr-3 w-100" id="searchbox"></div>
                        <button class="btn btn-secondary btn-lg" data-dismiss="modal" type="button">Fechar</button>
                    </div>
                    <div class="modal-body">
                        <div id="hits"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
        -->


<script>

    // Before shwoing searchbox
    $('#search').on('show.bs.modal', function (e) {

        // Client
        const searchClient = algoliasearch('5RYPGI69HZ', '53d709e59d833870a6886f6fcf0b0bfe');
        const search = instantsearch({
            indexName: 'cs50-2020-summer',
            searchClient: searchClient,
            searchFunction: function(helper) { // https://www.algolia.com/doc/guides/building-search-ui/going-further/conditional-display/js/#handling-empty-queries
                const hits = $('#hits');
                if (helper.state.query === '') {
                    hits.hide();
                    return;
                }
                helper.search();
                hits.show();
            }
        });

        // searchBox
        // https://www.algolia.com/doc/api-reference/widgets/search-box/js/
        search.addWidget(
            instantsearch.widgets.searchBox({
                container: '#searchbox',
                cssClasses: {
                    input: 'form-control'
                },
                placeholder: 'Search',
                showLoadingIndicator: false,
                showReset: false,
                showSubmit: false
            })
        );

        // hits
        // https://www.algolia.com/doc/api-reference/widgets/hits/js/
        search.addWidget(
            instantsearch.widgets.hits({
                container: '#hits',
                templates: {
                    item: function(hit) {

                        // url
                        if (window.baseurl) {
                            var url = window.baseurl + hit.url;
                        }
                        else {
                            var url = hit.url;
                        }
                        if (hit.anchor) {
                            url += '#' + hit.anchor;
                        }

                        // title
                        if (hit._highlightResult && hit._highlightResult.headings) {
                            var title = hit._highlightResult.headings[hit._highlightResult.headings.length - 1].value;
                        }
                        else if (hit._highlightResult && hit._highlightResult.title) {
                            var title = hit._highlightResult.title.value;
                        }
                        else if (hit.headings) {
                            var title = hit.headings[hit.headings.length - 1].value;
                        }
                        else if (hit.title) {
                            var title = hit.title;
                        }
                        else {
                            var title = url;
                        }

                        // content
                        if (hit._highlightResult && hit._highlightResult.content) {
                            var content = hit._highlightResult.content.value;
                        }
                        else if (hit._highlightResult && hit._highlightResult.title) {
                            var content = hit._highlightResult.title.value;
                        }
                        else {
                            var content = hit.excerpt_text;
                        }

                        // Template for hit
                        return '<h2 class="font-weight-bold h3 mb-0">' +
                               '<a href="' + url + '">' +
                               title +
                               '</a>' +
                               '</h2>' +
                               '<p class="mb-0">' +
                               '<a class="text-muted" href="' + url + '">' +
                               url +
                               '</a>' +
                               '</p>' +
                               '<p>' +
                               content +
                               '</p>';
                    }
                }
            })
        );

        // poweredBy
        search.addWidget(
            instantsearch.widgets.poweredBy({
                container: '#search .modal-footer'
            })
        );

        // Let user start searching
        search.start();

        // Resize form
        $(window).trigger('resize');
    });

    // After showing searchbox
    $('#search').on('shown.bs.modal', function (e) {
        $('#searchbox input[type=search]').focus();
    });

</script>


</body>
</html>
